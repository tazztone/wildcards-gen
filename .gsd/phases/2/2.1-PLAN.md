---
phase: 2
plan: 1
wave: 1
---

# Plan 2.1: Backend Parameter Exposure

## Objective
Update the core engine (`SmartConfig`, `smart.py`, `arranger.py`) to accept advanced tuning parameters for UMAP and HDBSCAN that were previously hardcoded. This paves the way for the GUI to expose them.

## Context
- wildcards_gen/core/smart.py
- wildcards_gen/core/arranger.py

## Tasks

<task type="auto">
  <name>Update SmartConfig</name>
  <files>wildcards_gen/core/smart.py</files>
  <action>
    Add the following fields to `SmartConfig.__init__` (with defaults matching current hardcoded values):
    - `umap_n_neighbors` (int, default=15)
    - `umap_min_dist` (float, default=0.1)
    - `umap_n_components` (int, default=5)
    - `hdbscan_min_samples` (int, default=None i.e. None implies =min_cluster_size)
    - `orphans_label_template` (str, default="misc") [Check if already exists, if so ensure passed down]
    
    Update `get_child_config` to propagate these values.
  </action>
  <verify>grep "umap_n_neighbors" wildcards_gen/core/smart.py</verify>
  <done>SmartConfig accepts new params</done>
</task>

<task type="auto">
  <name>Update Arranger Signatures</name>
  <files>wildcards_gen/core/arranger.py</files>
  <action>
    1. Update `compute_umap_embeddings` to accept `n_neighbors`, `min_dist`, `n_components`.
    2. Update `_arrange_single_pass` to accept `hdbscan_min_samples` (already likely exists as min_samples).
    3. Update `arrange_list` and `arrange_hierarchy` to accept `**kwargs` or specific args and pass them down to `_arrange_single_pass` and `compute_umap_embeddings`.
  </action>
  <verify>grep "n_neighbors=" wildcards_gen/core/arranger.py</verify>
  <done>Arranger functions accept tuning params</done>
</task>

<task type="auto">
  <name>Wire Smart to Arranger</name>
  <files>wildcards_gen/core/smart.py</files>
  <action>
    Update `apply_semantic_arrangement` to extract the new params from `config` and pass them into `arrange_hierarchy`.
  </action>
  <verify>grep "umap_n_neighbors" wildcards_gen/core/smart.py</verify>
  <done>Integration complete</done>
</task>

## Success Criteria
- [ ] `SmartConfig` stores UMAP/HDBSCAN settings.
- [ ] `arrange_hierarchy` respects passed settings (e.g., UMAP neighbors).
