---
phase: 5
plan: 1
wave: 1
---

# Plan 5.1: Centralized Taxonomy Logic

## Objective
Refactor taxonomy generation to use a centralized configuration for "Blacklisted Categories".
This ensures that the currently "accidental" support for the "Matter" root (via fallback) becomes **Explicit and Consistent** across all naming strategies (LCA and Medoid).

## Context
- `wildcards_gen/core/config.py`
- `wildcards_gen/core/wordnet.py`
- `wildcards_gen/core/arranger.py`

## Tasks

<task type="auto">
  <name>Centralize Blacklist Config</name>
  <files>
    wildcards_gen/core/config.py
    wildcards_gen/core/wordnet.py
    wildcards_gen/core/arranger.py
  </files>
  <action>
    1. In `config.py`:
       - Add `common_blacklist` property to `Config` class.
       - precise set: `{'entity', 'physical entity', 'abstraction', 'object', 'whole', 'unit', 'causal agent', 'variable', 'group'}`.
       - **EXCLUDE**: 'Matter', 'Substance' (allow these as valid roots per user request).
    2. In `wordnet.py`:
       - Remove `ABSTRACT_CATEGORIES` / `is_abstract_category` hardcoding.
       - Import `config` and use `config.common_blacklist`.
    3. In `arranger.py`:
       - Remove `BLACKLIST` hardcoding in `get_lca_name`.
       - Update `get_lca_name` and `get_medoid_name` to use `config.common_blacklist`.
  </action>
  <verify>
    Create script `scripts/verify_taxonomy_config.py`:
    - Test `get_lca_name` with term list matching "Matter" -> Assert "Matter" (Previously blocked).
    - Test `get_lca_name` with term list matching "Entity" -> Assert None (Blocked).
  </verify>
  <done>Taxonomy generation uses shared config; "Matter" is explicitly allowed.</done>
</task>

<task type="auto">
  <name>Verify Deep Nesting Preservation</name>
  <files>tests/test_shaper.py</files>
  <action>
    Add a regression test to `tests/test_shaper.py` that explicitly asserts strict nesting behavior:
    - Input: `Food` -> `Beverage` -> `Alcohol` -> `Wine`.
    - Output: MUST preserve full path (do NOT flatten `Beverage` -> `Alcohol`).
    - This codifies the user's preference as a requirement.
  </action>
  <verify>
    Run `pytest tests/test_shaper.py`.
  </verify>
  <done>Regression test confirms deep nesting is preserved.</done>
</task>

## Success Criteria
- [ ] `arranger.py` and `wordnet.py` have no hardcoded blacklists.
- [ ] "Matter" is returned by LCA check (not just Medoid fallback).
- [ ] "Entity" is still blocked.
- [ ] Test suite passes.
