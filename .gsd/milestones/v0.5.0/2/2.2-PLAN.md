---
phase: 2
plan: 2
wave: 2
---

# Plan 2.2: UI Sidebar & Controls

## Objective
Refactor the GUI to use `gr.Sidebar` for configuration (maximizing preview space) and expose the newly available backend parameters.

## Context
- wildcards_gen/gui.py
- wildcards_gen/core/config.py (if config schema needs update, though SmartConfig handles runtime)

## Tasks

<task type="auto">
  <name>Refactor to Sidebar Layout</name>
  <files>wildcards_gen/gui.py</files>
  <action>
    Move the "Configuration" `gr.Column` block into a `with gr.Sidebar():` block.
    Ensure "Extraction Mode" and "Source Dataset" remain prominent (or verify appropriate placement in Sidebar).
    The main content area should now primarily contain the Preview and Analysis panels.
  </action>
  <verify>grep "gr.Sidebar" wildcards_gen/gui.py</verify>
  <done>Layout uses Sidebar</done>
</task>

<task type="auto">
  <name>Add Advanced Controls</name>
  <files>wildcards_gen/gui.py</files>
  <action>
    Inside the "Fine-Tuning" or "Semantic Cleaning" Accordions (or a new "Deep Tuning" Accordion), add:
    - `ds_umap_neighbors` (Slider, 2-100, default 15)
    - `ds_umap_dist` (Slider, 0.0-1.0, default 0.1)
    - `ds_arr_samples` (Slider, 1-20, default=None/Same as min cluster)
    
    Update `generate_dataset_handler` to accept these inputs and pass to `SmartConfig` kwargs.
    Update `all_gen_inputs` list to include them.
  </action>
  <verify>grep "ds_umap_neighbors" wildcards_gen/gui.py</verify>
  <done>Controls exist and are wired</done>
</task>

<task type="auto">
  <name>Wire Live Preview</name>
  <files>wildcards_gen/gui.py</files>
  <action>
    Add the new components to `live_preview_triggers` so adjusting UMAP settings triggers a re-run if Fast Preview is on.
  </action>
  <verify>grep "ds_umap_neighbors.change" wildcards_gen/gui.py</verify>
  <done>Sliders trigger preview</done>
</task>

## Success Criteria
- [ ] Configuration is in a collapsible Sidebar.
- [ ] Users can adjust UMAP/HDBSCAN parameters in the GUI.
- [ ] Adjusting parameters updates the generated structure.
